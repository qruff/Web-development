{"ast":null,"code":"// Utils\nimport { defineComponent as _defineComponent,\n// eslint-disable-line no-restricted-imports\ncomputed, getCurrentInstance, shallowRef, watchEffect } from 'vue';\nimport { consoleWarn } from \"./console.mjs\";\nimport { mergeDeep, toKebabCase } from \"./helpers.mjs\";\nimport { injectSelf } from \"./injectSelf.mjs\";\nimport { DefaultsSymbol, provideDefaults, useDefaults } from \"../composables/defaults.mjs\";\nimport { useToggleScope } from \"../composables/toggleScope.mjs\"; // Types\nimport { propsFactory } from \"./propsFactory.mjs\";\nfunction propIsDefined(vnode, prop) {\n  var _vnode$props, _vnode$props2;\n  return typeof ((_vnode$props = vnode.props) == null ? void 0 : _vnode$props[prop]) !== 'undefined' || typeof ((_vnode$props2 = vnode.props) == null ? void 0 : _vnode$props2[toKebabCase(prop)]) !== 'undefined';\n}\nexport const defineComponent = function defineComponent(options) {\n  options._setup = options._setup ?? options.setup;\n  if (!options.name) {\n    consoleWarn('The component is missing an explicit name, unable to generate default prop value');\n    return options;\n  }\n  if (options._setup) {\n    options.props = options.props ?? {};\n    options.props = propsFactory(options.props, toKebabCase(options.name))();\n    options.props._as = String;\n    options.setup = function setup(props, ctx) {\n      const defaults = useDefaults();\n\n      // Skip props proxy if defaults are not provided\n      if (!defaults.value) return options._setup(props, ctx);\n      const vm = getCurrentInstance();\n      const componentDefaults = computed(() => defaults.value[props._as ?? options.name]);\n      const _props = new Proxy(props, {\n        get(target, prop) {\n          if (!propIsDefined(vm.vnode, prop)) {\n            var _componentDefaults$va, _global;\n            return ((_componentDefaults$va = componentDefaults.value) == null ? void 0 : _componentDefaults$va[prop]) ?? ((_global = defaults.value.global) == null ? void 0 : _global[prop]) ?? target[prop];\n          }\n          return Reflect.get(target, prop);\n        }\n      });\n      const _subcomponentDefaults = shallowRef();\n      watchEffect(() => {\n        if (componentDefaults.value) {\n          const subComponents = Object.entries(componentDefaults.value).filter(_ref => {\n            let [key] = _ref;\n            return key.startsWith(key[0].toUpperCase());\n          });\n          if (subComponents.length) _subcomponentDefaults.value = Object.fromEntries(subComponents);\n        }\n      });\n      const setupBindings = options._setup(_props, ctx);\n\n      // If subcomponent defaults are provided, override any\n      // subcomponents provided by the component's setup function.\n      // This uses injectSelf so must be done after the original setup to work.\n      useToggleScope(_subcomponentDefaults, () => {\n        var _injectSelf;\n        provideDefaults(mergeDeep(((_injectSelf = injectSelf(DefaultsSymbol)) == null ? void 0 : _injectSelf.value) ?? {}, _subcomponentDefaults.value));\n      });\n      return setupBindings;\n    };\n  }\n  return options;\n};\nexport function genericComponent() {\n  let exposeDefaults = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;\n  return options => (exposeDefaults ? defineComponent : _defineComponent)(options);\n}\nexport function defineFunctionalComponent(props, render) {\n  render.props = props;\n  return render;\n}","map":{"version":3,"mappings":"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","names":["defineComponent","_defineComponent","computed","getCurrentInstance","shallowRef","watchEffect","consoleWarn","mergeDeep","toKebabCase","injectSelf","DefaultsSymbol","provideDefaults","useDefaults","useToggleScope","propsFactory","propIsDefined","vnode","prop","props","_vnode$props","_vnode$props2","options","_setup","setup","name","_as","String","ctx","defaults","value","vm","componentDefaults","_props","Proxy","get","target","_componentDefaults$va","global","_global","Reflect","_subcomponentDefaults","subComponents","Object","entries","filter","_ref","key","startsWith","toUpperCase","length","fromEntries","setupBindings","_injectSelf","genericComponent","exposeDefaults","defineFunctionalComponent","render"],"sources":["../../src/util/defineComponent.tsx"],"sourcesContent":["// Utils\nimport {\n  defineComponent as _defineComponent, // eslint-disable-line no-restricted-imports\n  computed,\n  getCurrentInstance,\n  shallowRef,\n  watchEffect,\n} from 'vue'\nimport { consoleWarn } from '@/util/console'\nimport { mergeDeep, toKebabCase } from '@/util/helpers'\nimport { injectSelf } from '@/util/injectSelf'\nimport { DefaultsSymbol, provideDefaults, useDefaults } from '@/composables/defaults'\nimport { useToggleScope } from '@/composables/toggleScope'\n\n// Types\nimport type {\n  ComponentObjectPropsOptions,\n  ComponentOptions,\n  ComponentOptionsMixin,\n  ComponentOptionsWithObjectProps,\n  ComponentPropsOptions,\n  ComputedOptions,\n  DefineComponent,\n  EmitsOptions,\n  ExtractDefaultPropTypes,\n  ExtractPropTypes,\n  FunctionalComponent,\n  MethodOptions,\n  VNode,\n  VNodeChild,\n} from 'vue'\nimport { propsFactory } from '@/util/propsFactory'\n\nfunction propIsDefined (vnode: VNode, prop: string) {\n  return typeof vnode.props?.[prop] !== 'undefined' ||\n    typeof vnode.props?.[toKebabCase(prop)] !== 'undefined'\n}\n\nexport const defineComponent = (function defineComponent (options: ComponentOptions) {\n  options._setup = options._setup ?? options.setup\n\n  if (!options.name) {\n    consoleWarn('The component is missing an explicit name, unable to generate default prop value')\n\n    return options\n  }\n\n  if (options._setup) {\n    options.props = options.props ?? {}\n\n    options.props = propsFactory(options.props, toKebabCase(options.name))()\n\n    options.props._as = String\n    options.setup = function setup (props: Record<string, any>, ctx) {\n      const defaults = useDefaults()\n\n      // Skip props proxy if defaults are not provided\n      if (!defaults.value) return options._setup(props, ctx)\n\n      const vm = getCurrentInstance()!\n      const componentDefaults = computed(() => defaults.value![props._as ?? options.name!])\n      const _props = new Proxy(props, {\n        get (target, prop: string) {\n          if (!propIsDefined(vm.vnode, prop)) {\n            return componentDefaults.value?.[prop] ?? defaults.value!.global?.[prop] ?? target[prop]\n          }\n          return Reflect.get(target, prop)\n        },\n      })\n\n      const _subcomponentDefaults = shallowRef()\n      watchEffect(() => {\n        if (componentDefaults.value) {\n          const subComponents = Object.entries(componentDefaults.value).filter(([key]) => key.startsWith(key[0].toUpperCase()))\n          if (subComponents.length) _subcomponentDefaults.value = Object.fromEntries(subComponents)\n        }\n      })\n\n      const setupBindings = options._setup(_props, ctx)\n\n      // If subcomponent defaults are provided, override any\n      // subcomponents provided by the component's setup function.\n      // This uses injectSelf so must be done after the original setup to work.\n      useToggleScope(_subcomponentDefaults, () => {\n        provideDefaults(mergeDeep(\n          injectSelf(DefaultsSymbol)?.value ?? {},\n          _subcomponentDefaults.value\n        ))\n      })\n\n      return setupBindings\n    }\n  }\n\n  return options\n}) as unknown as typeof _defineComponent\n\ntype ToListeners<T extends string | number | symbol> = { [K in T]: K extends `on${infer U}` ? Uncapitalize<U> : K }[T]\n\nexport type SlotsToProps<T extends Record<string, any>> = T extends Record<string, Slot> ? ({\n  $children?: (\n    | VNodeChild\n    | (keyof T extends 'default' ? T['default'] : {})\n    | { [K in keyof T]?: T[K] }\n  )\n  'v-slots'?: { [K in keyof T]?: T[K] | false }\n} & {\n  [K in keyof T as `v-slot:${K & string}`]?: T[K] | false\n}) : T extends Record<string, any[]> ? SlotsToProps<MakeSlots<T>> : never\n\ntype Slot<T extends any[] = any[]> = (...args: T) => VNodeChild\nexport type MakeSlots<T extends Record<string, any[]>> = {\n  [K in keyof T]?: Slot<T[K]>\n}\n\nexport function genericComponent<T extends (new () => {\n  $props?: Record<string, any>\n})> (exposeDefaults = true): <\n  PropsOptions extends Readonly<ComponentPropsOptions>,\n  RawBindings,\n  D,\n  C extends ComputedOptions = {},\n  M extends MethodOptions = {},\n  Mixin extends ComponentOptionsMixin = ComponentOptionsMixin,\n  Extends extends ComponentOptionsMixin = ComponentOptionsMixin,\n  E extends EmitsOptions = Record<string, any>,\n  EE extends string = string,\n  I = InstanceType<T>,\n  Base = DefineComponent<\n    I extends Record<'$props', any>\n      ? Omit<PropsOptions, keyof I['$props']>\n      : PropsOptions,\n    RawBindings,\n    D,\n    C,\n    M,\n    Mixin,\n    Extends,\n    E extends any[] ? E : I extends Record<'$props', any> ? Omit<E, ToListeners<keyof I['$props']>> : E,\n    EE\n  >\n>(options: ComponentOptionsWithObjectProps<PropsOptions, RawBindings, D, C, M, Mixin, Extends, E, EE>) => Base & T {\n  return options => (exposeDefaults ? defineComponent : _defineComponent)(options) as any\n}\n\nexport function defineFunctionalComponent<\n  T extends FunctionalComponent<Props>,\n  PropsOptions = ComponentObjectPropsOptions,\n  Defaults = ExtractDefaultPropTypes<PropsOptions>,\n  Props = Readonly<ExtractPropTypes<PropsOptions>>,\n> (props: PropsOptions, render: T): FunctionalComponent<Partial<Defaults> & Omit<Props, keyof Defaults>> {\n  render.props = props as any\n  return render as any\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}