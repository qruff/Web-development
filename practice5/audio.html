<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Загрузка и сохранение аудиофайлов</title>
  </head>
  <body>
    <h1>Загрузка и сохранение аудиофайлов</h1>

    <form>
      <label>
        Загрузить аудиофайл:
        <input type="file" id="audioFile" multiple accept="audio/*" required>
      </label>
      <br>
      <button type="submit">Сохранить</button>
    </form>

    <h2>Сохраненные аудиофайлы:</h2>

    <select id="audioList"></select>
    <button id="deleteButton" onclick="handleDeleteButtonClick()" disabled>Удалить</button>
    <button id="playButton" onclick="handlePlayButtonClick()" disabled>Воспроизвести</button>
    
    <script>
      const audioList = document.getElementById('audioList');
      const deleteButton = document.getElementById('deleteButton');
      const playButton = document.getElementById('playButton');
      
      function updateAudioList() {
        // Очищаем список аудиофайлов
        audioList.innerHTML = '';

        // Добавляем сохраненные аудиофайлы в список
        for (let i = 0; i < localStorage.length; i++) {
          const fileName = localStorage.key(i);

          // Создаем новый элемент списка для файла
          const option = document.createElement('option');
          option.value = fileName;
          option.textContent = fileName;
          audioList.appendChild(option);
        }

        // Если список аудиофайлов пуст, отключаем кнопки удаления и воспроизведения
        if (localStorage.length === 0) {
          deleteButton.disabled = true;
          playButton.disabled = true;
        } else {
          deleteButton.disabled = false;
          playButton.disabled = false;
        }
      }
      
      function handleFormSubmit(event) {
        event.preventDefault();
        const audioFile = document.getElementById('audioFile').files[0];
        const fileName = audioFile.name;
        const reader = new FileReader();
        reader.onload = function(event) {
          localStorage.setItem(fileName, event.target.result);
          updateAudioList();
        };
        reader.readAsDataURL(audioFile);
      }

      function handleDeleteButtonClick() {
        const selectedFileName = audioList.value;
        localStorage.removeItem(selectedFileName);
        
    updateAudioList();
  }


  function handlePlayButtonClick() {
    
    const selectedFileName = audioList.value;
    const audioData = localStorage.getItem(selectedFileName);
    const audioElement = new Audio(audioData);
    audioElement.play();
  }
  
window.addEventListener('storage', (event) => {
  if (event.key === 'audioFile') {
    const audioList = document.getElementById('audioFile');
    audioList.innerHTML = '';
    
    const audioFiles = JSON.parse(event.newValue);
    for (const key in audioFiles) {
      const audioFile = audioFiles[key];
      const audioElement = createAudioElement(audioFile.url);
      audioElement.setAttribute('data-id', key);
      audioList.appendChild(audioElement);
    }
    
  }
});
function handleVisib(){
  if(document.visibilityState === 'visible'){
    location.reload();
  } 
}
window.addEventListener('visibilitychange', handleVisib);

  // Добавляем обработчики событий к элементам управления
  document.querySelector('form').addEventListener('submit', handleFormSubmit);
  
  // Обновляем список аудиофайлов при загрузке страницы
  updateAudioList();
</script>
  </body>
</html>